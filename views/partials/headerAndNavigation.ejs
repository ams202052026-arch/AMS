<header class="header">
    <div class="header-left">
        <img src="/image/logo.png" alt="AMS Logo" class="logo">
        <h1 class="system-title">AMS</h1>
    </div>

    <div class="header-right">
        <!-- Mode Indicator and Switch -->
        <div class="mode-indicator">
            <span class="current-mode" id="currentModeText">Customer</span>
            <button class="mode-switch-btn" id="modeSwitchBtn" onclick="showModeSwitchModal()">
                Business
            </button>
        </div>
        
        <a href="/notifications" class="notification-link">
            <img src="/image/notification.png" alt="Notifications" class="nav-icon">
            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
        </a>

        <div class="menu-dropdown">
            <img src="/image/menu.png" alt="Menu" class="nav-icon dropdown-toggle">

            <!-- Dropdown menu -->
            <ul class="dropdown-menu">
                <li><a href="/profile">Settings</a></li>
                <li><a href="#" onclick="showLogoutModal(event)">Logout</a></li>
            </ul>
        </div>
    </div>
</header>

<nav class="navigation">
    <ul>
        <li>
            <a href="/home">
                <img src="/image/home.png" alt="Home">
                <span>Home</span>
            </a>
        </li>

        <li>
            <a href="/appointments">
                <img src="/image/appointments.png" alt="Appointments">
                <span>Appointments</span>
            </a>
        </li>

        <li>
            <a href="/rewards">
                <img src="/image/rewardsLoyalty.png" alt="Rewards">
                <span>Rewards</span>
            </a>
        </li>

        <li>
            <a href="/history">
                <img src="/image/history.png" alt="History">
                <span>History</span>
            </a>
        </li>
    </ul>
</nav>

<!-- Mode Switch Modal -->
<div id="modeSwitchModal" class="modal-overlay" style="display: none;">
    <div class="modal-box">
        <span class="close-btn" onclick="closeModeSwitchModal()">&times;</span>
        <h3>Business Mode</h3>
        <p>To access business features, you need to apply for business verification first.</p>
        
        <div class="business-status-info">
            <p><strong>Current Status:</strong> <span id="businessStatus">Not Applied</span></p>
            <div id="statusMessage"></div>
        </div>
        
        <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="closeModeSwitchModal()">Cancel</button>
            <button type="button" class="btn-primary" id="businessActionBtn" onclick="handleBusinessAction()">Apply for Business</button>
        </div>
    </div>
</div>

<!-- Logout Confirmation Modal -->
<div id="logoutModal" class="modal-overlay" style="display: none;">
    <div class="modal-box">
        <span class="close-btn" onclick="closeLogoutModal()">&times;</span>
        <h3>Logout</h3>
        <p>Are you sure you want to logout?</p>
        
        <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="closeLogoutModal()">Cancel</button>
            <button type="button" class="btn-primary" onclick="confirmLogout()">Logout</button>
        </div>
    </div>
</div>

<script>
    function showLogoutModal(event) {
        event.preventDefault();
        document.getElementById('logoutModal').style.display = 'flex';
    }

    function closeLogoutModal() {
        document.getElementById('logoutModal').style.display = 'none';
    }

    function confirmLogout() {
        window.location.href = '/logout';
    }

    // Mode switching functions
    function showModeSwitchModal() {
        document.getElementById('modeSwitchModal').style.display = 'flex';
        checkBusinessStatus();
    }

    function closeModeSwitchModal() {
        document.getElementById('modeSwitchModal').style.display = 'none';
    }

    function checkBusinessStatus() {
        // Fetch actual business status from API
        fetch('/api/mode-status')
            .then(response => response.json())
            .then(data => {
                const statusElement = document.getElementById('businessStatus');
                const messageElement = document.getElementById('statusMessage');
                const actionBtn = document.getElementById('businessActionBtn');
                const currentModeText = document.getElementById('currentModeText');
                const modeSwitchBtn = document.getElementById('modeSwitchBtn');
                
                // Update current mode display
                if (data.currentMode === 'business') {
                    currentModeText.textContent = 'Business';
                    modeSwitchBtn.textContent = 'Customer';
                    modeSwitchBtn.onclick = () => window.location.href = '/switch-to-customer';
                } else {
                    currentModeText.textContent = 'Customer';
                    modeSwitchBtn.textContent = 'Business';
                    modeSwitchBtn.onclick = () => showModeSwitchModal();
                }
                
                const status = data.businessStatus;
                
                switch(status) {
                    case 'not_applied':
                        statusElement.textContent = 'Not Applied';
                        messageElement.innerHTML = '<p>You haven\'t applied for business verification yet.</p>';
                        actionBtn.textContent = 'Apply for Business';
                        actionBtn.onclick = () => window.location.href = '/business/register';
                        break;
                    case 'pending':
                        statusElement.textContent = 'Pending Review';
                        messageElement.innerHTML = '<p>Your business application is under review. You\'ll be notified once approved.</p>';
                        actionBtn.textContent = 'View Application';
                        actionBtn.onclick = () => window.location.href = '/business/status';
                        break;
                    case 'approved':
                        statusElement.textContent = 'Approved';
                        if (data.businessName) {
                            messageElement.innerHTML = `<p>Your business "<strong>${data.businessName}</strong>" has been approved! You can now switch to business mode.</p>`;
                        } else {
                            messageElement.innerHTML = '<p>Your business application has been approved! You can now switch to business mode.</p>';
                        }
                        actionBtn.textContent = 'Go to Business';
                        actionBtn.onclick = () => window.location.href = '/switch-to-business';
                        break;
                    case 'rejected':
                        statusElement.textContent = 'Rejected';
                        messageElement.innerHTML = '<p>Your business application was rejected. You can reapply with updated information.</p>';
                        actionBtn.textContent = 'Reapply';
                        actionBtn.onclick = () => window.location.href = '/business/reapply';
                        break;
                    case 'suspended':
                        statusElement.textContent = 'Suspended';
                        statusElement.style.color = '#ff9800';
                        if (data.businessName) {
                            messageElement.innerHTML = `<p style="color: #d32f2f;">Your business "<strong>${data.businessName}</strong>" has been suspended by the administrator.</p>`;
                        } else {
                            messageElement.innerHTML = '<p style="color: #d32f2f;">Your business has been suspended by the administrator.</p>';
                        }
                        if (data.suspensionReason) {
                            messageElement.innerHTML += `<p style="margin-top: 12px;"><strong>Reason:</strong> ${data.suspensionReason}</p>`;
                        }
                        messageElement.innerHTML += '<p style="margin-top: 12px; color: #666;">Please contact support for more information.</p>';
                        actionBtn.textContent = 'Close';
                        actionBtn.onclick = () => closeModeSwitchModal();
                        break;
                }
            })
            .catch(error => {
                console.error('Error fetching business status:', error);
                // Fallback to default state
                const statusElement = document.getElementById('businessStatus');
                const messageElement = document.getElementById('statusMessage');
                const actionBtn = document.getElementById('businessActionBtn');
                
                statusElement.textContent = 'Not Applied';
                messageElement.innerHTML = '<p>You haven\'t applied for business verification yet.</p>';
                actionBtn.textContent = 'Apply for Business';
                actionBtn.onclick = () => window.location.href = '/business/register';
            });
    }

    function handleBusinessAction() {
        // This function will be called based on the current status
        // The actual action is set in checkBusinessStatus()
    }

    // Close modal when clicking outside
    const logoutModal = document.getElementById('logoutModal');
    if (logoutModal) {
        logoutModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeLogoutModal();
            }
        });
    }

    const modeSwitchModal = document.getElementById('modeSwitchModal');
    if (modeSwitchModal) {
        modeSwitchModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeModeSwitchModal();
            }
        });
    }
    
    // Initialize mode display on page load
    initializeModeDisplay();
</script>

<script>
    // Initialize mode display
    function initializeModeDisplay() {
        fetch('/api/mode-status')
            .then(response => response.json())
            .then(data => {
                const currentModeText = document.getElementById('currentModeText');
                const modeSwitchBtn = document.getElementById('modeSwitchBtn');
                
                if (data.currentMode === 'business') {
                    currentModeText.textContent = 'Business Mode';
                    modeSwitchBtn.textContent = 'Switch to Customer';
                    modeSwitchBtn.onclick = () => window.location.href = '/switch-to-customer';
                } else {
                    currentModeText.textContent = 'Customer Mode';
                    modeSwitchBtn.textContent = 'Switch to Business';
                    modeSwitchBtn.onclick = () => showModeSwitchModal();
                }
            })
            .catch(error => {
                console.error('Error initializing mode display:', error);
            });
    }
</script>

<!-- About Us Modal -->
<div id="aboutModal" class="modal-overlay" style="display: none;">
    <div class="modal-box about-modal">
        <span class="close-btn" onclick="closeAboutModal()">&times;</span>
        <h2 class="about-title">About AMS</h2>
        
        <div class="about-content">
            <section class="about-section">
                <h3>Who We Are</h3>
                <p>Our Digital Queue and Appointment Management System helps customers book services from small businesses easily. Whether you're visiting a salon, clinic, or repair shop, our platform helps you avoid long lines and stressful manual scheduling.</p>
            </section>

            <section class="about-section">
                <h3>What We Offer</h3>
                <p>With our platform, you can:</p>
                <ul class="about-list">
                    <li>Create an account with secure email verification</li>
                    <li>Browse services and choose your preferred staff</li>
                    <li>Book appointments based on your ideal date and time</li>
                    <li>Receive an instant queue number</li>
                    <li>Track all appointments in your calendar</li>
                </ul>
            </section>

            <section class="about-section">
                <h3>How It Helps</h3>
                <p>Our system keeps you updated with:</p>
                <ul class="about-list">
                    <li>Appointment confirmations</li>
                    <li>Reminders</li>
                    <li>Status updates</li>
                </ul>
            </section>

            <section class="about-section purpose">
                <h3>Our Purpose</h3>
                <p>To make your service experience faster, fairer, and more convenient.</p>
                <p class="purpose-values">No waiting. No confusion. No hassle.</p>
            </section>
        </div>
    </div>
</div>

<script>
    function showAboutModal() {
        document.getElementById('aboutModal').style.display = 'flex';
    }

    function closeAboutModal() {
        document.getElementById('aboutModal').style.display = 'none';
    }

    // Close modal when clicking outside
    const aboutModal = document.getElementById('aboutModal');
    if (aboutModal) {
        aboutModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeAboutModal();
            }
        });
    }
</script>
