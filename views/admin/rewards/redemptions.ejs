<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reward Redemptions - AMS Admin</title>
    <link rel="icon" type="image/png" href="/image/favicon.png">
    <link rel="stylesheet" href="/css/scrollbar.css">
    <link rel="stylesheet" href="/css/admin/main.css">
    <link rel="stylesheet" href="/css/admin/dashboard-redesign.css">
</head>
<body>
    <div class="dashboard-layout">
        <%- include('../partials/sidebar') %>

        <main class="main-content">
            <!-- Header -->
            <div class="dashboard-header">
                <h1>Reward Redemptions</h1>
                <p class="date"><%= new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></p>
            </div>

            <!-- Back Button -->
            <div style="margin-bottom: 24px;">
                <a href="/admin/rewards" class="btn btn-secondary" style="display: inline-flex; align-items: center; gap: 8px; background: #f5f5f5; color: #1a1a1a;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Back to Rewards
                </a>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number"><%= redemptions.length %></span>
                    <span class="stat-label">Total Redemptions</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number"><%= redemptions.filter(r => r.status === 'active').length %></span>
                    <span class="stat-label">Active</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number"><%= redemptions.filter(r => r.status === 'pending').length %></span>
                    <span class="stat-label">Pending</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number"><%= redemptions.filter(r => r.status === 'used').length %></span>
                    <span class="stat-label">Used</span>
                </div>
            </div>

            <!-- Redemptions List -->
            <div class="card">
                <div class="card-header">
                    <h3>Redemption History</h3>
                    <span style="color: #666; font-size: 14px;"><%= redemptions.length %> redemptions</span>
                </div>
                <div class="card-body">
                    <% if (redemptions.length === 0) { %>
                        <div style="text-align: center; padding: 60px 20px; color: #999;">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" style="margin-bottom: 16px; opacity: 0.3;">
                                <path d="M3 3V21H21V3H3ZM9 17H7V10H9V17ZM13 17H11V7H13V17ZM17 17H15V13H17V17Z" fill="currentColor"/>
                            </svg>
                            <h3 style="font-size: 16px; margin-bottom: 8px;">No redemptions yet</h3>
                            <p style="font-size: 14px;">Redemptions will appear here when customers claim rewards</p>
                        </div>
                    <% } else { %>
                        <table>
                            <thead>
                                <tr>
                                    <th>Redeemed Date</th>
                                    <th>Customer</th>
                                    <th>Reward</th>
                                    <th>Points Used</th>
                                    <th>Status</th>
                                    <th>Used Date</th>
                                    <th>Appointment</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% redemptions.forEach(redemption => { %>
                                    <tr>
                                        <td><%= new Date(redemption.redeemedAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></td>
                                        <td>
                                            <% if (redemption.customer) { %>
                                                <div style="display: flex; flex-direction: column;">
                                                    <span style="font-weight: 600; color: #1a1a1a;"><%= redemption.customer.firstName %> <%= redemption.customer.lastName %></span>
                                                    <span style="font-size: 12px; color: #666;"><%= redemption.customer.email %></span>
                                                </div>
                                            <% } else { %>
                                                <span style="color: #999;">N/A</span>
                                            <% } %>
                                        </td>
                                        <td>
                                            <% if (redemption.reward) { %>
                                                <div style="display: flex; flex-direction: column;">
                                                    <span style="font-weight: 600; color: #1a1a1a;"><%= redemption.reward.name %></span>
                                                    <span style="font-size: 12px; color: #1a1a1a;">
                                                        <%= redemption.reward.discountType === 'percentage' 
                                                            ? redemption.reward.discountValue + '% OFF' 
                                                            : 'â‚±' + redemption.reward.discountValue + ' OFF' %>
                                                    </span>
                                                </div>
                                            <% } else { %>
                                                <span style="color: #999;">Deleted Reward</span>
                                            <% } %>
                                        </td>
                                        <td><strong><%= redemption.pointsUsed %></strong> pts</td>
                                        <td>
                                            <% if (redemption.status === 'active') { %>
                                                <span class="status-badge status-pending" style="background: #dbeafe; color: #1e40af;">Active</span>
                                            <% } else if (redemption.status === 'pending') { %>
                                                <span class="status-badge status-pending" style="background: #fef3c7; color: #92400e;">Pending</span>
                                            <% } else if (redemption.status === 'used') { %>
                                                <span class="status-badge status-approved">Used</span>
                                            <% } else if (redemption.status === 'expired') { %>
                                                <span class="status-badge status-rejected">Expired</span>
                                            <% } else { %>
                                                <span class="status-badge status-suspended"><%= redemption.status %></span>
                                            <% } %>
                                        </td>
                                        <td>
                                            <%= redemption.usedAt 
                                                ? new Date(redemption.usedAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) 
                                                : '-' %>
                                        </td>
                                        <td>
                                            <% if (redemption.appliedToAppointment) { %>
                                                <span style="color: #1a1a1a; display: flex; align-items: center; gap: 4px;">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                                        <path d="M8 12L11 15L16 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    </svg>
                                                    Applied
                                                </span>
                                            <% } else { %>
                                                <span style="color: #999;">-</span>
                                            <% } %>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    <% } %>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Highlight active nav item
        document.addEventListener('DOMContentLoaded', function() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.getAttribute('href') === '/admin/rewards') {
                    item.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
